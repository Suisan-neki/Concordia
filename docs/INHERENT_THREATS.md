# 内在的脅威（Inherent Threats）の詳細分析

## 概要

Concordia が対処する「脅威」は外部攻撃者ではない。  
脅威は**内部に宿る心理的防衛反応**である。

従来のセキュリティモデルは外部攻撃者の侵入を想定するが、  
医療現場の透明性を阻むのは「人間の恐れ・不安」である。

---

## 脅威1: 医師の「疑われることへの恐れ」

### 具体的な症状
1. **防衛的な説明**
   - 患者の質問を「難癖」として捉える
   - 説明を最小限に抑えようとする
   - 「分かりましたか？」という確認を避ける

2. **証拠作りの心理**
   - 「記録に残すこと」を目的化
   - 患者の同意を「取り付ける」ことに集中
   - 本当の理解を確認しない

3. **訴訟への恐れ**
   - 患者の表情・態度を過剰に気にする
   - 「嫌な顔をされた」と思い込む
   - 説明を避ける、または強制的に合意を取ろうとする

### 技術的な対処法

#### 1.1 透明性による安心感
```
【実装】
- 全ての操作が記録されることを明示
- 医師も患者も同じ Ledger を見られる
- 圧力や誘導の痕跡を技術的に検証可能に

【効果】
- 「疑われない」安心感
- 透明性が医師を守る
```

#### 1.2 質問を「脅威」ではなく「学習機会」として記録
```
【実装】
- 質問の回数が「学習指標」として表示
- 「患者が質問できた」＝「医師の説明が分かりやすかった」と解釈
- 質問をポジティブに評価

【効果】
- 医師が質問を恐れなくなる
- オープンな対話が促進される
```

#### 1.3 合意を「押し付けた記録」ではなく「対話の軌跡」として記録
```
【実装】
- 合意のプロセス全体を記録
- 「押した」だけでなく「押さなかった」選択も記録
- 合意の質を評価

【効果】
- 医師が「押し付けた」と責められない安心感
```

---

## 脅威2: 患者の「発言をためらってしまう閉塞感」

### 具体的な症状
1. **権威に対する服従**
   - 医師の前で「分かりません」と言えない
   - 「分かりました」と答えるしかない状況
   - 質問すると「嫌な顔をされる」と思い込む

2. **時間的な圧力**
   - 「長い診療時間を取らせてしまった」という罪悪感
   - 急かされている感じ
   - 「今、質問するタイミングではない」という判断

3. **情報格差による不安**
   - 医師が使う専門用語が理解できない
   - 「バカにされる」と思い込む
   - 質問することが「不適切」だと思い込む

### 技術的な対処法

#### 2.1 質問の「匿名化」と「遅延送信」
```
【実装】
- 質問をリアルタイムではなく、後から送信可能に
- 質問の送信を「後日送信」として予約
- 医師には「匿名化」して表示（オプション）

【効果】
- 患者がリアルタイムで質問を考えなくて良い
- 安心して質問できる
```

#### 2.2 質問の「フリーフォーム」と「テンプレート」の併用
```
【実装】
- 患者が「どこが分からないか」を明確にできるテンプレート
- 例：「手術のリスクについて」「術後の回復について」
- 自由記述も可能にする

【効果】
- 質問のハードルを下げる
- 質問しやすい環境を作る
```

#### 2.3 「合意しない権利」の明示
```
【実装】
- 「後で考える」「家族と相談する」を選択肢として提示
- 押さない自由を保障
- 「押さなかった」ことも Ledger に記録

【効果】
- 患者がプレッシャーを感じない
- 自分のペースで合意を形成できる
```

---

## 脅威3: 第三者（家族・監査者）からの「過剰監視」

### 具体的な症状
1. **家族からの監視**
   - 家族が患者の同意を後ろで監視
   - 患者が「本当の気持ちを言えない」
   - 家族の意向に従わざるを得ない

2. **監査者からの監視**
   - 医療法遵守のための監査が過剰
   - 医師が「監査に引っかからないこと」を優先
   - 真の対話が阻害される

3. **メディア・SNS への拡散リスク**
   - 「変なことを言われた」という投稿リスク
   - 合意プロセスの一部だけが切り取られる
   - 文脈が失われる

### 技術的な対処法

#### 3.1 Selective Visibility（ABAC）
```
【実装】
- 家族は「メタデータのみ」閲覧可能
- 患者の質問内容は本人と医師のみ閲覧
- 監査者は「合意の有無」のみ確認可能

【効果】
- 過剰監視を防ぐ
- プライバシーを保護
```

#### 3.2 合意プロセスの「全履歴記録」
```
【実装】
- 合意に至るまでの全てのやり取りを記録
- 文脈を失わない
- 一部分だけが切り取られることを防ぐ

【効果】
- 悪意のある拡散を防ぐ
- 真実が歪められることを防ぐ
```

#### 3.3 患者の「可視性制御」
```
【実装】
- 患者が「誰に何を見せるか」を制御可能
- 家族に一部を見せない選択も可能
- 監査者への公開範囲も制御可能

【効果】
- 患者の主体性を確保
- 過剰監視から解放
```

---

## 脅威4: システム自体が「圧力の道具」になる

### 具体的な症状
1. **合意の強制**
   - システムが「合意してください」と催促
   - 合意しないと先に進めない
   - システムが患者を責める

2. **数値による評価**
   - 「理解度スコア」が低いと責められる
   - 「質問が少なすぎる」と警告される
   - 数値で評価されるプレッシャー

3. **記録が「証拠」として使われる**
   - 合意が「法的証拠」として扱われる
   - 患者が「後で不利になる」と思い込む
   - 合意を避ける

### 技術的な対処法

#### 4.1 「記録しない権利」の保障
```
【実装】
- システムを使わない選択も可能
- 記録を部分的に消去する機能
- オプトアウトを明示的に提示

【効果】
- システムが圧力にならない
- 本当に自発的な合意を促す
```

#### 4.2 評価を「数値」ではなく「提案」として提示
```
【実装】
- 「理解度スコア」を廃止
- 「もう少し詳しく説明すると良いかも」という提案
- 「良い/悪い」ではなく「より良い対話のための提案」

【効果】
- 評価されるプレッシャーを減らす
- 改善を促進する
```

#### 4.3 記録を「証拠」ではなく「学習素材」として位置づけ
```
【実装】
- 記録を見せるのは患者本人のみ（オプション）
- 「証拠」ではなく「対話の記録」として扱う
- 患者が「後で不利になる」と思わない設計

【効果】
- 記録を恐れない
- オープンな対話を促進
```

---

## 実装の優先順位

### Phase 1: 即座に対処すべき脅威
1. ✅ **合意しない権利の明示**
   - 既に実装済み（PENDING アクション）
2. ✅ **合意プロセスの全履歴記録**
   - 既に実装済み（Comprehension Ledger）
3. ⏳ **質問の遅延送信**
   - 次に実装すべき機能

### Phase 2: 中期的に対処すべき脅威
4. ⏳ **評価を「提案」として提示**
   - P7 の実装として進行中
5. ⏳ **Selective Visibility（ABAC）の強化**
   - 現在部分的に実装済み

### Phase 3: 長期的に対処すべき脅威
6. ⏳ **家族・監査者への可視性制御**
   - 複数ステークホルダー対応が必要
7. ⏳ **システムの圧力検知**
   - 「システムが圧力をかけている」ことを検出する機能

---

## まとめ

内在的脅威は**技術だけでは解決できない**。  
しかし、**技術で「構造的に」対処できる**部分がある。

重要なのは：
1. **透明性を確保**（医師の安心感）
2. **選択肢を保障**（患者の自由）
3. **評価を提案に変換**（プレッシャーの軽減）
4. **記録を学習素材に**（証拠化を避ける）

これらの技術的対処法を段階的に実装することで、  
**ゼロプレッシャー合意**を実現できる。

---

## 内在的脅威とセキュリティ技術の対応表

### 対応表

| 内在的脅威 | セキュリティ技術 | 実装方法 | ステータス |
|-----------|----------------|----------|----------|
| **医師の疑われることへの恐れ** | | | |
| 1. 防衛的な説明 | **透明性の保証** | Merkle Chain による改ざん検知 | ✅ 実装済み |
| 2. 証拠作りの心理 | **不可否認性** | Ed25519 署名 + TSA トークン | ✅ 実装済み |
| 3. 訴訟への恐れ | **全履歴記録** | Comprehension Ledger | ✅ 実装済み |
| | **ABAC によるアクセス制御** | Selective Visibility | ⏳ 部分実装 |
| **患者の発言をためらう閉塞感** | | | |
| 1. 権威に対する服従 | **匿名化** | 質問の匿名送信機能 | ⏳ 未実装 |
| 2. 時間的な圧力 | **遅延送信** | 「後日送信」機能 | ⏳ 未実装 |
| 3. 情報格差による不安 | **テンプレート質問** | 質問フォーム機能 | ⏳ 未実装 |
| | **合意しない権利** | PENDING アクション | ✅ 実装済み |
| **第三者からの過剰監視** | | | |
| 1. 家族からの監視 | **ABAC** | 属性ベースアクセス制御 | ⏳ 部分実装 |
| 2. 監査者からの監視 | **Selective Visibility** | 役割ベースの可視性制御 | ⏳ 部分実装 |
| 3. SNS への拡散リスク | **改ざん検知** | Merkle Chain | ✅ 実装済み |
| | **全履歴記録** | 文脈を失わない記録 | ✅ 実装済み |
| **システム自体が圧力になる** | | | |
| 1. 合意の強制 | **オプトアウト** | 記録しない権利 | ⏳ 未実装 |
| 2. 数値による評価 | **非評価的設計** | P7: 双方を否定しない | ✅ 実装済み |
| 3. 記録が証拠になる | **学習素材としての記録** | 証拠化を避ける設計 | ⏳ 未実装 |

---

## セキュリティ技術の詳細

### 1. 透明性の保証（Transparency）

**技術:** Merkle Chain  
**脅威への対処:** 医師の疑われることへの恐れ

```
【実装】
- 全理解行動を Merkle Chain で記録
- 改ざんを検知可能
- 医師も患者も同じ Ledger を見られる

【セキュリティ効果】
- 「疑われない」安心感
- 圧力や誘導の痕跡を技術的に検証可能
- 医師が防衛的に説明する必要がなくなる
```

**検証コマンド:**
```bash
python scripts/verify_chain.py --session-id sess-1
```

### 2. 不可否認性（Non-repudiation）

**技術:** Ed25519 署名 + TSA トークン  
**脅威への対処:** 証拠作りの心理

```
【実装】
- 合意時に Ed25519 署名を要求
- TSA トークンで時刻証明
- 署名検証に失敗したイベントは拒否

【セキュリティ効果】
- 「後で言っていない」を防ぐ
- 医師が証拠作りをする必要がなくなる
- 透明性が医師を守る
```

**公開鍵登録:**
```python
POST /auth/keys
{
  "actor_id": "patient-1",
  "public_key": "ed25519:..."
}
```

### 3. セレクティブ可視性（ABAC）

**技術:** 属性ベースアクセス制御  
**脅威への対処:** 第三者からの過剰監視

```
【実装】
- PolicyContext(subject_id, role, purpose) で評価
- 患者は自身セッションのみ閲覧
- 家族はメタデータのみ閲覧
- 監査者は合意の有無のみ確認

【セキュリティ効果】
- 過剰監視を防ぐ
- 患者のプライバシーを保護
- 家族が患者の合意を監視することを防ぐ
```

**ポリシー例:**
```python
# 患者は自分のセッションのみ閲覧可能
if subject.role == "patient" and event.actor_id == subject.id:
    return ALLOW

# 家族はメタデータのみ閲覧可能
if subject.role == "family" and purpose == "support":
    return ALLOW_METADATA_ONLY

# 監査者は合意の有無のみ確認可能
if subject.role == "auditor" and purpose == "compliance":
    return ALLOW_AGREEMENT_STATUS_ONLY
```

### 4. 匿名化・遅延送信

**技術:** プライバシー保護データ処理  
**脅威への対処:** 患者の発言をためらう閉塞感

```
【実装】
- 質問を「後日送信」として予約
- 医師には「匿名化」して表示（オプション）
- リアルタイムで質問を考えなくて良い

【セキュリティ効果】
- 患者が安心して質問できる
- 権威に対する服従から解放
- 時間的な圧力から解放
```

**実装イメージ:**
```python
# 質問の遅延送信
POST /events
{
  "act_type": "clarify_request",
  "payload": {
    "question": "手術のリスクについて",
    "send_later": true,
    "send_at": "2024-01-15T10:00:00Z",
    "anonymous": true  # オプション
  }
}
```

### 5. オプトアウト（記録しない権利）

**技術:** 同意管理システム  
**脅威への対処:** システム自体が圧力になる

```
【実装】
- システムを使わない選択も可能
- 記録を部分的に消去する機能
- オプトアウトを明示的に提示

【セキュリティ効果】
- システムが圧力にならない
- 本当に自発的な合意を促す
- 記録を恐れない
```

**実装イメージ:**
```python
# オプトアウトの記録
POST /events
{
  "act_type": "opt_out",
  "payload": {
    "reason": "家族と相談したい",
    "scope": "temporary"  # temporary or permanent
  }
}
```

---

## セキュリティアーキテクチャ全体像

```
┌─────────────────────────────────────────────────────────┐
│              内在的脅威の防御レイヤー                      │
├─────────────────────────────────────────────────────────┤
│  1. 透明性の保証 (Merkle Chain)                          │
│     → 医師の疑われることへの恐れを軽減                    │
├─────────────────────────────────────────────────────────┤
│  2. 不可否認性 (Ed25519 + TSA)                          │
│     → 証拠作りの心理を除去                                │
├─────────────────────────────────────────────────────────┤
│  3. セレクティブ可視性 (ABAC)                           │
│     → 過剰監視を防ぐ                                      │
├─────────────────────────────────────────────────────────┤
│  4. 匿名化・遅延送信                                      │
│     → 患者の閉塞感を軽減                                  │
├─────────────────────────────────────────────────────────┤
│  5. オプトアウト                                          │
│     → システムが圧力にならない                            │
└─────────────────────────────────────────────────────────┘
```

---

## 次のステップ

### Phase 1: 既存技術の強化
- ✅ Merkle Chain の検証機能
- ✅ Ed25519 署名 + TSA トークン
- ⏳ ABAC の実装強化

### Phase 2: プライバシー保護機能
- ⏳ 質問の匿名化・遅延送信
- ⏳ オプトアウト機能
- ⏳ テンプレート質問機能

### Phase 3: 統合的セキュリティ
- ⏳ セキュリティポリシーの一元管理
- ⏳ 脅威検知とアラート機能
- ⏳ セキュリティ監査ログ

---

## まとめ

内在的脅威への対処は、従来のセキュリティ技術を**人間の心理的防衛反応**に適用することで実現できる。

重要なのは：
1. **透明性**で医師を守る
2. **匿名化**で患者を守る
3. **可視性制御**で第三者からの監視を防ぐ
4. **オプトアウト**でシステムが圧力にならない

これらのセキュリティ技術を段階的に実装することで、  
**ゼロプレッシャー合意**を技術的に実現できる。
