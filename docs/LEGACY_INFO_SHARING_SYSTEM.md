# 患者情報共有システム — 開発者向け詳細（2024/9 時点）

本ドキュメントは、2024年9月まで実装していた「患者情報共有システム」の技術概要と到達点を記録する。後半に、既存EHR/マイナポータルとの差別化上の課題と、Concordia への転換理由を簡潔に整理する。

---

## 1. 目的とビジョン
- 医療従事者と患者の間で医療情報を安全に共有するWebアプリケーション。
- 分散指向・オープンコミュニティ志向により、医療AI開発の参入障壁を下げ、データ多様性を確保する。

## 2. 機能概要
- セキュリティ
  - デジタル署名: RSA 2048bit + PSS + SHA-256
  - 暗号化: AES-256-GCM、PBKDF2-SHA256
  - 認証: TOTP + WebAuthn（FIDO2）
  - アクセス制御: RBAC + ABAC
  - 監査: 操作ログのハッシュチェーン、UTCタイムスタンプ
- UI
  - 医師向け管理画面、患者向け表示、アクセシビリティ（大きな文字/ふりがな）
  - WebSocket によるリアルタイム反映
- 連携/管理
  - FHIR R4/CSV I/O、REST API
  - セキュリティ検証ダッシュボード、WebAuthn管理、監査ダッシュボード

## 3. アーキテクチャ/技術
- バックエンド: Python 3.9+, Flask, SQLAlchemy, JSON中心
- フロント: HTML5/CSS3/ES6、DOM操作、WebSocket
- データ管理: ファイルベース（PoC）、メモリキャッシュ
- 構成: MVC/REST、Flask-Login によるセッション管理

## 4. セットアップ/デモ
- リポジトリ: `Suisan-neki/SecHack365_electronic-medical-record`
- 起動: `python run_app.py`（`info_sharing_system/`）、自動起動用 `.\start_systems.bat`（自分用）
- アクセス: http://localhost:5001（メイン）、http://localhost:5002（模擬EHR）
- デモアカウント: `doctor1`, `admin1`, `patient1`

## 5. 現在の課題（当時）
- スケーラビリティ/可用性: 単一サーバ/ファイルベース起因の制約
- データ整合性: 同時アクセスとACID保全の難しさ
- 鍵管理/HSM, 量子耐性, ゼロトラスト/監視の未整備

---

## 6. 差別化上の課題（EHR/マイナポータルとの比較）
- 目的の重なり: 「安全に共有する」は既存EHR/マイナポータル（PHR窓口）で部分達成済み。
- 記録の粒度: 文書/項目の“事実”中心で、対話や理解の“過程”は脇役になりがち。
- 検証可能性: 第三者が手元で検証する設計（ハッシュ/署名/時刻の再計算）は限定的。
- 心理的圧力: セキュリティ強化が、現場では“圧力の道具”として作用し得る。

## 7. 転換の理由（Concordia へ）
- 何を扱うかの再定義: 合意そのものではなく「理解しようとした行動の痕跡」。
- 検証主役の設計: Merkle連鎖/署名/時刻を前面に、第三者が再現可能に。
- 圧力の中和: “責めない数”（秘匿集計+DP）、目的限定トークン（見せすぎない透明性）。
- 役割分担: EHR=医療行為の記録、Concordia=理解行動の検証可能な痕跡。

---

## 8. 参考リンク
- 製品README（当時）: SecHack365_project/README.md（本リポジトリ外の旧構成）
- 現行の設計/技術文書: `docs/SECURITY_TECHNOLOGIES.md`, `docs/INHERENT_THREATS.md`, `docs/VALUE_PROPOSITION.md`

