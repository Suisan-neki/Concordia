# ã‚¼ãƒ­ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼åˆæ„ã«ãŠã‘ã‚‹é«˜åº¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æŠ€è¡“

## æ¦‚è¦

**å€‹äººå®Ÿè£…ã ã‹ã‚‰ã“ãã®å¼·ã¿**  
æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯å€‹äººé–‹ç™ºã®ãŸã‚ã€å¤§è¦æ¨¡é‹ç”¨ã®åˆ¶ç´„ãŒãªã„ã€‚  
å¾“æ¥ã®ã€Œç½²åã€ã®ã‚ˆã†ãªå¤å…¸çš„ãªæŠ€è¡“ã§ã¯ãªãã€**ãƒ‹ãƒƒãƒã§å…ˆé€²çš„ãªæŠ€è¡“**ã‚’è©¦ã›ã‚‹å ´ã¨ã—ã¦æ´»ç”¨ã™ã‚‹ã€‚

> **æŠ€è¡“é¸å®šã®æ–¹é‡**  
> âœ… ã‚³ã‚¹ãƒˆåŠ¹ç‡ã‚ˆã‚Šã‚‚**æŠ€è¡“çš„å¥½å¥‡å¿ƒ**ã‚’å„ªå…ˆ  
> âœ… å®Ÿç”¨æ€§ã‚ˆã‚Šã‚‚**å®Ÿé¨“çš„ä¾¡å€¤**ã‚’è¿½æ±‚  
> âœ… éå‰°ãªæŠ€è¡“ã‚‚å«ã‚ã¦**è©¦ã—ã¦ã¿ã‚‹ä¾¡å€¤ãŒã‚ã‚‹**

---

## ç¾çŠ¶ã®å®Ÿè£…ï¼ˆå¾“æ¥æŠ€è¡“ï¼‰

### Ed25519 ç½²å + TSA ãƒˆãƒ¼ã‚¯ãƒ³ âœ… å®Ÿè£…æ¸ˆã¿

```python
# concoridia/app/domain/sign.py
from cryptography.hazmat.primitives.asymmetric.ed25519 import Ed25519PrivateKey

def generate_keypair() -> Tuple[bytes, bytes]:
    private_key = Ed25519PrivateKey.generate()
    public_key = private_key.public_key()
    return (private_key.private_bytes(...), public_key.public_bytes(...))
```

**ãªãœç½®ãæ›ãˆã‚‹ã‹ï¼Ÿ**
- Ed25519ã¯ã€Œç¢ºç«‹ã•ã‚ŒãŸæŠ€è¡“ã€
- å€‹äººå®Ÿè£…ãªã‚‰ã€ã‚‚ã£ã¨**é¢ç™½ã„æŠ€è¡“**ã‚’è©¦ã›ã‚‹
- ã€Œè–„ã£ãºã‚‰ããªã„ã€æŠ€è¡“ã‚’å®Ÿè£…ã—ã¦ã¿ãŸã„

---

## 1. ã‚¼ãƒ­çŸ¥è­˜è¨¼æ˜ï¼ˆZero-Knowledge Proofsï¼‰â­ æœ€å„ªå…ˆå®Ÿè£…

### ãªãœå®Ÿè£…ã™ã¹ãã‹

å¾“æ¥ã®ç½²åæŠ€è¡“ã§ã¯ï¼š
```
æ‚£è€…: ã€Œæ‰‹è¡“ã®ãƒªã‚¹ã‚¯ã‚’ç†è§£ã—ã¾ã—ãŸã€â†’ [ç½²å]
åŒ»å¸«: ç½²åã‚’ç¢ºèªï¼ˆå†…å®¹ã‚‚è¦‹ãˆã‚‹ï¼‰
```

å•é¡Œï¼š
- åŒ»å¸«ãŒæ‚£è€…ã®ã€ŒåŒæ„å†…å®¹ã€ã‚’è¦‹ã¦ã—ã¾ã†
- æ‚£è€…ã¯ã€Œæœ¬å½“ã®æ°—æŒã¡ã€ã‚’è¨€ãˆãªã„
- ç½²åã¨ã„ã†ã€Œè¨˜éŒ²ã€ãŒåœ§åŠ›ã«ãªã‚‹

### ã‚¼ãƒ­çŸ¥è­˜è¨¼æ˜ãªã‚‰

```
æ‚£è€…: ã€Œæ‰‹è¡“ã®ãƒªã‚¹ã‚¯ã‚’ç†è§£ã—ãŸã€ã¨ã„ã†ã€Œè¨¼æ˜ã€ã‚’ç”Ÿæˆ
åŒ»å¸«: è¨¼æ˜ã®ã€ŒçœŸå½ã€ã®ã¿ã‚’æ¤œè¨¼ï¼ˆå†…å®¹ã¯è¦‹ãˆãªã„ï¼‰
```

**å®Ÿè£…ä¾‹:**
```python
# æ‚£è€…ãŒã€Œç†è§£ã—ãŸã€ã¨ã„ã†è¨¼æ˜ã‚’ç”Ÿæˆï¼ˆå†…å®¹ã¯éš ã™ï¼‰
zk_proof = generate_zk_proof(
    statement="æ‰‹è¡“ã®ãƒªã‚¹ã‚¯ã‚’ç†è§£ã—ãŸ",
    secret="å…·ä½“çš„ãªä¸å®‰ã‚„è³ªå•å†…å®¹",
    private_key=patient_key
)

# åŒ»å¸«ã¯è¨¼æ˜ã®æœ‰åŠ¹æ€§ã®ã¿ã‚’æ¤œè¨¼
is_valid = verify_zk_proof(zk_proof)
# True â†’ æ‚£è€…ã¯ç†è§£ã—ã¦ã„ã‚‹ï¼ˆå†…å®¹ã¯ä¸æ˜ï¼‰
```

### å®Ÿè£…æ–¹é‡

1. **Circom + SnarkJS** ã§å›è·¯ã‚’å®šç¾©
2. **Bellman** (Rust) / **Arkworks** (Rust) ã§å®Ÿè£…
3. Python ã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’é€šã˜ã¦å‘¼ã³å‡ºã—

### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·**: å†…å®¹ã‚’ä¸€åˆ‡æ˜ã‹ã•ãªã„
- âœ… **åœ§åŠ›ã®è»½æ¸›**: ã€Œä½•ã‚’ç†è§£ã—ãŸã‹ã€ã‚’å…¬é–‹ã™ã‚‹å¿…è¦ãŒãªã„
- âœ… **æŠ€è¡“çš„æŒ‘æˆ¦**: å€‹äººå®Ÿè£…ã§å­¦ã¹ã‚‹æ©Ÿä¼š

### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âš ï¸ è¨ˆç®—ã‚³ã‚¹ãƒˆãŒé«˜ã„ï¼ˆæ•°ç§’ã€œæ•°åˆ†ï¼‰
- âš ï¸ å®Ÿè£…ãŒè¤‡é›‘ï¼ˆã—ã‹ã—æŒ‘æˆ¦ã™ã‚‹ä¾¡å€¤ãŒã‚ã‚‹ï¼‰

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
```bash
# å¿…è¦ãªãƒ„ãƒ¼ãƒ«
sudo npm install -g circom snarkjs
pip install python-snark
```

---

## 2. å·®åˆ†ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ï¼ˆDifferential Privacyï¼‰â­ ä½µè¡Œå®Ÿè£…

### ãªãœå®Ÿè£…ã™ã¹ãã‹

å¾“æ¥ã®çµ±è¨ˆå…¬é–‹ã§ã¯ï¼š
```
ã€Œæ‚£è€…100äººä¸­80äººãŒåŒæ„ã—ã¾ã—ãŸã€
â†’ å€‹äººã‚’ç‰¹å®šã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
```

å•é¡Œï¼š
- çµ±è¨ˆã‹ã‚‰å€‹äººã®å›ç­”ã‚’æ¨æ¸¬ã§ãã‚‹
- GDPR/HIPAA ã«æº–æ‹ ã§ããªã„

### å·®åˆ†ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãªã‚‰

```
ã€Œæ‚£è€…100äººä¸­80äººãŒåŒæ„ã—ã¾ã—ãŸ (Â±3%)ã€
â†’ å€‹äººã‚’ç‰¹å®šã™ã‚‹ã“ã¨ã¯ä¸å¯èƒ½
```

### å®Ÿè£…æ–¹é‡

```python
# concordia/app/services/differential_privacy.py
import numpy as np

def laplace_mechanism(data: list[bool], epsilon: float = 1.0):
    """ãƒ©ãƒ—ãƒ©ã‚¹ãƒã‚¤ã‚ºã‚’åŠ ãˆã¦å·®åˆ†ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’å®Ÿç¾"""
    true_count = sum(data)
    sensitivity = 1  # å€‹äºº1äººã®å½±éŸ¿
    scale = sensitivity / epsilon
    
    # ãƒ©ãƒ—ãƒ©ã‚¹ãƒã‚¤ã‚ºã‚’åŠ ãˆã‚‹
    noisy_count = true_count + np.random.laplace(0, scale)
    
    return {
        "count": int(noisy_count),
        "confidence": f"Â±{int(scale * 3)}",
        "privacy": epsilon
    }
```

### ä½¿ç”¨ä¾‹

```python
# çµ±è¨ˆã‚’å…¬é–‹ã—ãŸã„ãŒã€å€‹äººæƒ…å ±ã¯ä¿è­·ã—ãŸã„
agreements = [True, True, False, True, False, ...]  # 100äººã®å›ç­”

# å·®åˆ†ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’é©ç”¨
private_stats = laplace_mechanism(agreements, epsilon=1.0)

print(f"{private_stats['count']}% ã®æ‚£è€…ãŒåŒæ„ã—ã¾ã—ãŸ ({private_stats['confidence']})")
# "77% ã®æ‚£è€…ãŒåŒæ„ã—ã¾ã—ãŸ (Â±3)"
# â†’ ã“ã®çµ±è¨ˆã‹ã‚‰å€‹äººã‚’ç‰¹å®šã™ã‚‹ã“ã¨ã¯ä¸å¯èƒ½
```

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
```bash
pip install numpy scipy diffprivlib
```

---

## 3. ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ç½²åï¼ˆBlind Signaturesï¼‰â­ ãƒ‹ãƒƒãƒæŠ€è¡“

### ãªãœå®Ÿè£…ã™ã¹ãã‹

å¾“æ¥ã®ç½²åã§ã¯ï¼š
```
æ‚£è€…: ã€Œæ‰‹è¡“ã«åŒæ„ã—ã¾ã™ã€â†’ [Ed25519ç½²å]
åŒ»å¸«: ç½²åã‚’ç¢ºèªï¼ˆå†…å®¹ã‚‚è¦‹ãˆã‚‹ï¼‰
```

### ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ç½²åãªã‚‰

```
æ‚£è€…: å†…å®¹ã‚’ã€Œç›²ç›®åŒ–ã€ã—ã¦ç½²åã‚’å–å¾—
åŒ»å¸«: ç½²åã®æœ‰åŠ¹æ€§ã®ã¿ã‚’ç¢ºèªï¼ˆå†…å®¹ã¯è¦‹ãˆãªã„ï¼‰
```

### å®Ÿè£…æ–¹é‡

```python
# concordia/app/domain/blind_signature.py
from cryptography.hazmat.primitives.asymmetric import rsa
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.asymmetric import padding
import hashlib

def blind_message(message: bytes, public_key) -> bytes:
    """ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç›²ç›®åŒ–"""
    # ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ã‚’ç”Ÿæˆ
    blind_factor = secrets.token_bytes(32)
    
    # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒãƒƒã‚·ãƒ¥åŒ–
    message_hash = hashlib.sha256(message).digest()
    
    # ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰åŒ–
    blinded = (message_hash, blind_factor, public_key)
    return blinded

def sign_blinded(blinded: bytes, private_key) -> bytes:
    """ç›²ç›®åŒ–ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ç½²å"""
    signature = private_key.sign(
        blinded,
        padding.PSS(
            mgf=padding.MGF1(hashes.SHA256()),
            salt_length=padding.PSS.MAX_LENGTH
        ),
        hashes.SHA256()
    )
    return signature

def unblind_signature(blinded_signature: bytes, blind_factor: bytes) -> bytes:
    """ç½²åã‚’è„±ç›²"""
    # ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ã‚’å–ã‚Šé™¤ã
    unblinded = blinded_signature
    return unblinded
```

### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… **å†…å®¹ã®ç§˜åŒ¿æ€§**: åŒ»å¸«ã¯æ‚£è€…ã®åˆæ„å†…å®¹ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ããªã„
- âœ… **ç½²åã®æœ‰åŠ¹æ€§**: Ed25519ã¨åŒç­‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- âœ… **ãƒ‹ãƒƒãƒãªæŠ€è¡“**: å®Ÿè£…ä¾‹ãŒå°‘ãªã„

---

## 4. ãƒˆãƒƒãƒ—ãƒ¬ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚·ã‚§ã‚¢ãƒªãƒ³ã‚°ï¼ˆTop-Secret Sharingï¼‰

### ãªãœå®Ÿè£…ã™ã¹ãã‹

è¤‡æ•°ã®åˆ©å®³é–¢ä¿‚è€…ï¼ˆæ‚£è€…ãƒ»åŒ»å¸«ãƒ»å®¶æ—ï¼‰ãŒé–¢ä¸ã™ã‚‹å ´åˆï¼š

```
ã€å¾“æ¥ã®æ–¹æ³•ã€‘
æ‚£è€…: ã€Œæ‰‹è¡“ã«åŒæ„ã—ã¾ã™ã€
åŒ»å¸«: ã€Œèª¬æ˜ã‚’å®Œäº†ã—ã¾ã—ãŸã€
å®¶æ—: ã€Œå®¶æ—ã¨ã—ã¦åŒæ„ã—ã¾ã™ã€
â†’ å…¨ã¦ã®å›ç­”ãŒå…¨å“¡ã«è¦‹ãˆã‚‹ï¼ˆãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒªã‚¹ã‚¯ï¼‰

ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚·ã‚§ã‚¢ãƒªãƒ³ã‚°ã€‘
æ‚£è€…ãƒ»åŒ»å¸«ãƒ»å®¶æ—ãŒãã‚Œãã‚Œã€Œç§˜å¯†ã€ã‚’åˆ†æ•£
â†’ åˆæ„ã®çµæœã®ã¿ãŒæ˜ã‚‰ã‹ï¼ˆå„å‚åŠ è€…ã®å›ç­”ã¯ä¸æ˜ï¼‰
```

### å®Ÿè£…æ–¹é‡

```python
# concordia/app/domain/secret_sharing.py
from secretsharing import secret_int_to_points, points_to_secret_int

def split_secret(secret: str, num_shares: int, threshold: int):
    """ç§˜å¯†ã‚’åˆ†æ•£"""
    secret_int = int.from_bytes(secret.encode(), 'big')
    shares = secret_int_to_points(secret_int, threshold, num_shares)
    return shares

def reconstruct_secret(shares: list):
    """åˆ†æ•£ã•ã‚ŒãŸç§˜å¯†ã‹ã‚‰å¾©å…ƒ"""
    secret_int = points_to_secret_int(shares)
    secret_bytes = secret_int.to_bytes((secret_int.bit_length() + 7) // 8, 'big')
    return secret_bytes.decode()

# ä½¿ç”¨ä¾‹
patient_secret = "æ‰‹è¡“ã«åŒæ„ã—ã¾ã™"
doctor_secret = "èª¬æ˜ã‚’å®Œäº†ã—ã¾ã—ãŸ"
family_secret = "å®¶æ—ã¨ã—ã¦åŒæ„ã—ã¾ã™"

# å„å‚åŠ è€…ãŒç§˜å¯†ã‚’åˆ†æ•£
patient_shares = split_secret(patient_secret, num_shares=3, threshold=2)
doctor_shares = split_secret(doctor_secret, num_shares=3, threshold=2)
family_shares = split_secret(family_secret, num_shares=3, threshold=2)

# åˆæ„ã‚’è¨ˆç®—ï¼ˆç§˜å¯†ã¯å¾©å…ƒã—ãªã„ï¼‰
# â†’ å„å‚åŠ è€…ã®å›ç­”ã¯ä¸æ˜ã ãŒã€åˆæ„ã®çµæœã¯åˆ†ã‹ã‚‹
```

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
```bash
pip install secretsharing
```

---

## æ¨å¥¨ã•ã‚Œã‚‹æŠ€è¡“é¸æŠï¼ˆå€‹äººå®Ÿè£…å‘ã‘ï¼‰

### æœ€å„ªå…ˆå®Ÿè£… â­â­â­

1. **ã‚¼ãƒ­çŸ¥è­˜è¨¼æ˜ï¼ˆZK-SNARKsï¼‰** 
   - ç†ç”±: æœ€ã‚‚é©æ–°çš„ã§ã€å€‹äººå®Ÿè£…ã§å­¦ã¶ä¾¡å€¤ãŒé«˜ã„
   - é›£æ˜“åº¦: é«˜
   - ãƒ„ãƒ¼ãƒ«: Circom + SnarkJS

2. **å·®åˆ†ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼**
   - ç†ç”±: å®Ÿè£…ãŒæ¯”è¼ƒçš„ç°¡å˜ã§ã€ã™ãã«ä¾¡å€¤ã‚’æä¾›ã§ãã‚‹
   - é›£æ˜“åº¦: ä¸­
   - ãƒ„ãƒ¼ãƒ«: `diffprivlib`, NumPy

3. **ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ç½²å**
   - ç†ç”±: ãƒ‹ãƒƒãƒãªæŠ€è¡“ã ãŒã€å®Ÿè£…ä¾‹ãŒå°‘ãªã„
   - é›£æ˜“åº¦: ä¸­
   - ãƒ„ãƒ¼ãƒ«: `cryptography`

### å°†æ¥çš„ã«æ¤œè¨ ğŸ”„

- **ãƒãƒ«ãƒãƒ‘ãƒ¼ãƒ†ã‚£è¨ˆç®—ï¼ˆMPCï¼‰**: è¤‡æ•°ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼å¯¾å¿œãŒå¿…è¦ãªå ´åˆ
- **å®Œå…¨æº–åŒå‹æš—å·ï¼ˆFHEï¼‰**: è¨ˆç®—ã‚³ã‚¹ãƒˆãŒé«˜ã™ãã‚‹ï¼ˆã—ã‹ã—æŒ‘æˆ¦ã™ã‚‹ä¾¡å€¤ã¯ã‚ã‚‹ï¼‰

---

## å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 1: å·®åˆ†ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ï¼ˆ1-2é€±é–“ï¼‰
```bash
# å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«
concordia/app/services/differential_privacy.py
concordia/tests/test_differential_privacy.py
```

### Phase 2: ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ç½²åï¼ˆ2-3é€±é–“ï¼‰
```bash
# å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«
concordia/app/domain/blind_signature.py
concordia/tests/test_blind_signature.py
```

### Phase 3: ã‚¼ãƒ­çŸ¥è­˜è¨¼æ˜ï¼ˆ3-4é€±é–“ï¼‰
```bash
# å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«
circuits/understanding_proof.circom
concordia/app/services/zk_proof.py
concordia/tests/test_zk_proof.py
```

### Phase 4: ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚·ã‚§ã‚¢ãƒªãƒ³ã‚°ï¼ˆ1-2é€±é–“ï¼‰
```bash
# å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«
concordia/app/domain/secret_sharing.py
concordia/tests/test_secret_sharing.py
```

---

## ã¾ã¨ã‚

**å€‹äººå®Ÿè£…ã ã‹ã‚‰ã“ãã§ãã‚‹ã“ã¨**

1. **ãƒ‹ãƒƒãƒãªæŠ€è¡“**ã‚’è©¦ã›ã‚‹
2. **ã‚³ã‚¹ãƒˆåŠ¹ç‡**ã‚ˆã‚Šã‚‚**æŠ€è¡“çš„å¥½å¥‡å¿ƒ**ã‚’å„ªå…ˆ
3. **å®Ÿç”¨æ€§**ã‚ˆã‚Šã‚‚**å®Ÿé¨“çš„ä¾¡å€¤**ã‚’è¿½æ±‚
4. **éå‰°ãªæŠ€è¡“**ã‚‚å«ã‚ã¦**è©¦ã—ã¦ã¿ã‚‹ä¾¡å€¤ãŒã‚ã‚‹**

Ed25519 ã®ã‚ˆã†ãªã€Œç¢ºç«‹ã•ã‚ŒãŸæŠ€è¡“ã€ã§ã¯ãªãã€**ã‚‚ã£ã¨é¢ç™½ã„æŠ€è¡“**ã‚’å®Ÿè£…ã—ã¦ã¿ã‚‹ã€‚

ã“ã‚ŒãŒå€‹äººå®Ÿè£…ã®é†é†å‘³ã§ã‚ã‚‹ã€‚
